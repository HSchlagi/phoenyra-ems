bess:
  efficiency_charge: 0.95
  efficiency_discharge: 0.95
  energy_capacity_kwh: 200.0
  power_charge_max_kw: 100.0
  power_discharge_max_kw: 100.0
  soc_max_percent: 90.0
  soc_min_percent: 10.0
database:
  history_path: data/ems_history.db
ems:
  mode: auto
  optimization_interval_minutes: 15
  timestep_s: 2
forecast:
  demo_mode: true
  latitude: 48.2082
  load_forecast_method: simple
  longitude: 16.3738
  openweathermap_api_key: null
  pv_efficiency: 0.85
  pv_forecast_method: simple
  pv_peak_power_kw: 50.0
  use_prophet: false
  use_weather: false
modbus:
  enabled: false
  profile: hithium_ess_5016
  connection_type: tcp
  host: localhost
  port: 502
  slave_id: 1
  timeout: 3.0
  retries: 3
  poll_interval_s: 2.0
  status_codes:
    '0': Initialisierung
    '1': Laden
    '2': Entladen
    '3': Bereit
    '5': Ladesperre
    '6': Entladesperre
    '7': Lade- & Entladesperre
    '8': Fehler
  registers:
    soc_percent:
      address: 4
      function: 4
      count: 1
      data_type: uint16
      scale: 1.0
      offset: 0.0
      unit: '%'
      description: System State of Charge
      category: telemetry
      zero_based: false
      signed: false
    soh_percent:
      address: 5
      function: 4
      count: 1
      data_type: uint16
      scale: 1.0
      offset: 0.0
      unit: '%'
      description: System State of Health
      category: telemetry
      zero_based: false
      signed: false
    voltage_v:
      address: 2
      function: 4
      count: 1
      data_type: uint16
      scale: 0.1
      offset: 0.0
      unit: V
      description: System-Gesamtspannung
      category: telemetry
      zero_based: false
      signed: false
    current_a:
      address: 3
      function: 4
      count: 1
      data_type: uint16
      scale: 0.1
      offset: -3200.0
      unit: A
      description: Systemstrom (positiv = Laden, negativ = Entladen)
      category: telemetry
      zero_based: false
      signed: false
    temperature_c:
      address: 42
      function: 4
      count: 1
      data_type: uint16
      scale: 1.0
      offset: -40.0
      unit: C
      description: Durchschnittliche Systemtemperatur
      category: telemetry
      zero_based: false
      signed: false
    max_discharge_power_kw:
      address: 32
      function: 4
      count: 1
      data_type: uint16
      scale: 0.1
      offset: 0.0
      unit: kW
      description: Zul채ssige maximale Entladeleistung
      category: limit
      zero_based: false
      signed: false
    max_charge_power_kw:
      address: 33
      function: 4
      count: 1
      data_type: uint16
      scale: 0.1
      offset: 0.0
      unit: kW
      description: Zul채ssige maximale Ladeleistung
      category: limit
      zero_based: false
      signed: false
    max_discharge_current_a:
      address: 34
      function: 4
      count: 1
      data_type: uint16
      scale: 0.1
      offset: 0.0
      unit: A
      description: Zul채ssiger maximaler Entladestrom
      category: limit
      zero_based: false
      signed: false
    max_charge_current_a:
      address: 35
      function: 4
      count: 1
      data_type: uint16
      scale: 0.1
      offset: 0.0
      unit: A
      description: Zul채ssiger maximaler Ladestrom
      category: limit
      zero_based: false
      signed: false
    insulation_resistance_kohm:
      address: 45
      function: 4
      count: 1
      data_type: uint16
      scale: 1.0
      offset: 0.0
      unit: kOhm
      description: System-Isolationswiderstand
      category: diagnostics
      zero_based: false
      signed: false
    status_code:
      address: 43
      function: 4
      count: 1
      data_type: uint16
      scale: 1.0
      offset: 0.0
      description: Systemstatus laut BMS
      category: status
      zero_based: false
      signed: false
    pcs_comm_fault:
      address: 46
      function: 4
      count: 1
      data_type: uint16
      scale: 1.0
      offset: 0.0
      description: Kommunikation PCS <-> BMS (0=OK, 1=Fehler)
      category: diagnostics
      zero_based: false
      signed: false
    ems_comm_fault:
      address: 47
      function: 4
      count: 1
      data_type: uint16
      scale: 1.0
      offset: 0.0
      description: Kommunikation EMS <-> BMS (0=OK, 1=Fehler)
      category: diagnostics
      zero_based: false
      signed: false
mqtt:
  enabled: true
  broker_host: 192.168.1.73
  broker_port: 1883
  username: mqtt
  password: 1965_e
  client_id: phoenyra_ems
  keepalive: 60
  qos: 1
  topics:
    publish:
      alerts: ems/alerts
      bess: bess/data
      optimization: ems/optimization
      status: ems/status
    subscribe:
      telemetry: homeassistant/sensor/MSA-280024210086/quick/state
      commands: ems/commands
      config: ems/config
      setpoints: ems/setpoints
      strategy: ems/strategy_override
power_control:
  enabled: false
  max_power_kw: 500.0
  auto_write: false
  signals:
    dso_trip:
      register: status_word
      mask: 4
    safety_alarm:
      register: alarm_word
      mask: 1
    dso_limit_pct:
      register: active_power_limit_pct
      scale: 0.1
      min_pct: 0
      max_pct: 100
  writes:
    remote_enable:
      register: remote_enable
      on: 1
      off: 0
    active_power_set_w:
      register: active_power_set_w
      scale: 1.0
    active_power_limit_pct:
      register: active_power_limit_pct
      scale: 0.1
prices:
  demo_mode: false
  provider: awattar
  region: AT
sites:
  db_path: ../data/ems.db
  default_site_id: 1
strategies:
  arbitrage:
    min_price_spread: 20.0
    min_profit_threshold: 5.0
  load_balancing:
    smoothing_window: 3
    target_load_factor: 0.8
  manual_strategy: arbitrage
  peak_shaving:
    peak_threshold_percentile: 75
    target_peak_reduction: 20
  selection_mode: auto
  self_consumption:
    feedin_tariff: 0.08
    grid_tariff: 0.3
  switch_threshold: 0.15
